\section{استفاده از \lr{stack} برای ادغام}
\begin{frame}{ساختار \lr{\texttt{MergeState}}}
\begin{itemize}\itemr
\item[-]
ساختاری در کد‌هایی که مربوط به الگوریتم تیم‌سورت پیدا می‌شود به اسم \lr{\texttt{MergeState}}؛ این ساختار اطلاعات مورد نیاز برای توابع ادغام را داراست.

\item[-]
اطلاعات دیگری که در این ساختار نگهداری می‌شوند:
\begin{enumerate}\itemr
\item 
مقدار 
\lr{\texttt{min\_gallop}}

\item 
اندازه‌ی استک \lr{Run}ها:
\lr{\texttt{n}}

\item 
خود استک \lr{Run}ها:
\lr{\texttt{pending}}

\item 
آرایه‌ی موقت ادغام کردن:
\lr{\texttt{temparray}}

\item 
و سه تابع
\lr{\texttt{key\_compare}}،
\lr{\texttt{key\_richcompare}} و
\lr{\texttt{tuple\_elem\_compare}}
برای سناریو‌های مختلف مقایسه کردن بین عناصر آرایه.
\end{enumerate}
\end{itemize}
\end{frame}

\begin{frame}{جلوگیری از اجرای بازگشتی}
\begin{itemize}\itemr
\item[-]
توابع بازگشتی وقتی که صدا زده می‌شوند، اطلاعات هر بار صدا زده شدن آنها، در
\lr{CPython}،
داخل آبجکتِ
\lr{frame}
آنها (\lr{frame}، آبجکتی است که اطلاعات و \lr{context} مورد نیاز برای یک \lr{code object} که حاوی \lr{byte code}‌های پایتون است را فراهم و ذخیره می‌کند) در یک \lr{stack} ذخیره می‌شوند،

\item[-]
اما آقای تیم پیترز این الگوریتم را که ماهیت بازگشتی مانندی دارد را غیر بازگشتی نوشته است و برای اینکار از یک \lr{stack} مخصوص خودش در سطح کد استفاده می‌کند.

\item[-]
هر بار که یک \lr{Run} پیدا می‌شود و اندازه‌ی آن به \lr{\texttt{minrun}} و یا بیشتر می‌رسد، اطلاعات آن روی \lr{stack} گذاشته می‌شود.

\item[-]
اگر بخواهیم ساده نگاه کنیم فرض می‌کنیم که خود \lr{Run} روی استک گذاشته می‌شود اما در واقع فقط آدرس شروع و اندازه‌ی آن روی استک ذخیره می‌شود تا از تکه تکه کردن آرایه و اشغال فضای بیشتر جلوگیری شود.
\end{itemize}
\end{frame}

\begin{frame}{استکِ \lr{\texttt{pending}}}
\begin{itemize}\itemr
\item[-]
این استک، نقاط شروع و طول هر \lr{Run} را در خودش ذخیره می‌کند.

\item[-]
این یعنی:

\lr{Run} عه
\lr{\texttt{i}}ام
از آدرس
\lr{\texttt{base[i]}}
شروع شده،
\lr{\texttt{len[i]}}
تا ادامه دارد و این عبارت همیشه درست است:
\begin{latin}
\begin{flushleft}
\texttt{pending[i].base + pending[i].len == pending[i+1].base}
\end{flushleft}
\end{latin}
\end{itemize}
\end{frame}
